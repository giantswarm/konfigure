variables:
  - name: installation-name
    required: true
  - name: app-name
    required: true
layers:
  - id: defaults
    path:
      directory: default
      required: true
    values:
      path:
        directory: ""
      configMap:
        name: config.yaml
    templates:
      path:
        directory: apps/<< app-name >>
        required: true
      configMap:
        name: configmap-values.yaml.template
        required: true
        values:
          merge:
            - layerId: defaults
              type: configMap
            - layerId: management-cluster
              type: configMap
      secret:
        name: secret-values.yaml.template
        required: true
        values:
          merge:
            - layerId: defaults
              type: configMap
            - layerId: management-cluster
              type: configMap
            - layerId: defaults
              type: secret
            - layerId: management-cluster
              type: secret
  - id: management-cluster
    path:
      directory: installations/<< installation-name >>
      required: true
    values:
      path:
        directory: ""
      configMap:
        name: config.yaml.patch
        required: true
      secret:
        name: secret.yaml
        required: true
    templates:
      path:
        directory: apps/<< app-name >>
        required: false
      configMap:
        name: configmap-values.yaml.patch
        required: false
        values:
          merge:
            - layerId: defaults
              type: configMap
            - layerId: management-cluster
              type: configMap
      secret:
        name: secret-values.yaml.patch
        required: false
        values:
          merge:
            - layerId: management-cluster
              type: secret
includes:
  - id: include
    function:
      name: include
    path:
      directory: include
      required: true # unused
    extension: .yaml.template
  - id: include-self
    function:
      name: includeSelf
    path:
      directory: include-self
      required: false # unused
    extension: .yaml.template
